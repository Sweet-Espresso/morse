let drop = document.querySelector('.drop')

// Puxada ao clicar no perfil depois de logado
function usuario() {
  
}

function cadOrLogin(a) {
  drop.style.height = '100vh'
  drop.style.width = '100vw'
  drop.style.display = 'flex'
  this.mode = a
  metodoCadOrLogin()
}

function metodoCadOrLogin() {
    var alterCadLogin = document.querySelectorAll('#drop-form .cad')
    var btnLoginOrCad = document.querySelector('.btn-login-or-cad')
    var aLoginOrCad = document.querySelector('.a-login-or-cad')
    reset()
    if (this.mode !== "cad") {
        alterCadLogin.forEach((a) => {
          a.style.display = 'none'
          reset()
          })
        btnLoginOrCad.innerHTML = "Entrar"
        aLoginOrCad.innerHTML = "Criar Conta"
        this.mode = "cad"
    } else {
        alterCadLogin.forEach((a) => {
            a.style.display = 'inline-block'
        })
        btnLoginOrCad.innerHTML = "Enviar"
        aLoginOrCad.innerHTML = "Entrar"
        this.mode = "login"
    }
}

function signinOrCad() {
    this.mode === 'cad' ? signin() : cadastro()
}

function cadastro() {

    user = {
        usuario: document.getElementById('usuario-inp').value,
        senha: document.getElementById('senha-inp').value,
        validationSenha: document.getElementById('senha-inp-feedback').value
    }
    const body = JSON.stringify(user)
    fetch('/usuarios', {
        method: "POST",
        body: body,
        headers: {
            "Content-type": "application/json; charset=UTF-8"
        }
    })
        .then(data => {console.log(data); data.text()} )
        .then((textContent) => {
            if (textContent) throw textContent
            reset()
            metodoCadOrLogin()
            msg()
        })
        .catch(err => {console.log(err); msg(err)} )
}

function msg(a) {
    if(a[0] === 'usuario') {
    let usuarioInp = document.getElementById('usuario-inp')
    let usuarioInpFeedback = document.getElementById('usuario-inp-feedback')
    usuarioInp.className = "form-control is-invalid";
    usuarioInpFeedback.className = 'invalid-feedback';
    usuarioInpFeedback.innerHTML = a[1]
    } else {
      usuarioInp.className = "form-control is-valid";
    }
    if(a[0] === 'senha' && !a[2]) {
    let senhaInp = document.getElementById('senha-inp')
    let senhaInpFeedback = document.getElementById('senha-inp-feedback')
    senhaInp.className = "form-control is-invalid";
    senhaInpFeedback.className = 'invalid-feedback';
    senhaInpFeedback.innerHTML = a[1]
    } else {
      senhaInp.className = "form-control is-valid";
    }
    if(a[2]) {
    let validationSenhaInp = document.getElementById('senha-inp-feedback')
    let validationSenhaInpFeedback = document.getElementById('validation-senha-inp-feedback')
    validationSenhaInp.className = "form-control is-invalid";
    validationSenhaInpFeedback.className = 'invalid-feedback';
    validationSenhaInpFeedback.innerHTML = a[1]
    } else {
    validationSenhaInp.className = "form-control is-valid"
    }
  //usuarioInp.className = "form-control is-valid";
}

function signin() {
    user = {
        usuario: document.querySelector('#usuario-inp').value,
        senha: document.querySelector('#senha-inp').value
    }
    const body = JSON.stringify(user)
    fetch('/signins', {
        method: "POST",
        body: body,
        headers: {
            "Content-type": "application/json; charset=UTF-8"
        }
    })
        .then((res) => res.json())
        .then((data) => {
            if (data.error) throw data.error
            let keys = JSON.stringify(data[0])
            localStorage.setItem('user', keys)
            getUser()
            reset()
        })
        .catch(err => msg(err))

}
//PAREI AQUI
function reset() {
    let inputCad = document.querySelectorAll("#drop-form .cad")
    let inputLogin = document.querySelectorAll("#drop-form .login")
    inputCad.forEach((a) => a.querySelector('input').value = "")
    inputLogin.forEach((a) => a.querySelector('input').value = "")
    let feedback = [document.getElementById('validation-senha-inp-feedback'), document.getElementById('usuario-inp-feedback'), document.getElementById('senha-inp-feedback')]
    let inpClass = [document.getElementById('validation-senha-inp'), document.getElementById('usuario-inp'), document.getElementById('senha-inp')]
    feedback.forEach(a => {
      a.className = ''
      a.innerHTML = ''
    })
    inpClass.forEach(a => {
      a.className = 'form-control'
    })
    //this.mode !== "login" ? down() : null
}

function down() {
  drop.style.display = 'none'
  reset()
}